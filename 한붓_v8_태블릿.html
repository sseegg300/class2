<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<title>ë‚˜ë„ ì˜¤ì¼ëŸ¬ì²˜ëŸ¼ - íƒœë¸”ë¦¿ ì „ìš©</title>
<style>
  :root{
    --bg:#0f1220;
    --text:#0b0d1a;
    --light:#ffffff;
    --muted:#475569;
    --menu-grad: linear-gradient(90deg, #62b3ff 0%, #8a7bff 50%, #a05eff 100%);
    --menu-inner: linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.35));
    --btn-gray: linear-gradient(180deg, #6b7a85, #4e5a64);
    --btn-blue: linear-gradient(180deg, #0eb0ff, #0076ff);
    --badge-bg: rgba(255,255,255,.28);
    --panel: rgba(255,255,255,.06);
    --shadow: 0 10px 30px rgba(0,0,0,.35);
    --radius: 16px;
  }

  *{ box-sizing:border-box; }
  html,body{ height:100%; }
  body{
    margin:0;
    padding: 10px 12px calc(env(safe-area-inset-bottom,0) + 12px);
    background: radial-gradient(1200px 900px at 30% -10%, #1a2142 0%, #0f1220 50%, #0b0d1a 100%);
    color:#e9edf5;
    font: 16px/1.6 system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
    overscroll-behavior: none;
  }

  .app{ max-width: 1100px; margin: 0 auto; }

  /* ====== ìƒë‹¨ ë©”ë‰´(ì²¨ë¶€ ìŠ¤íƒ€ì¼) ====== */
  .menubar{
    display:flex; align-items:center; gap:14px;
    padding: 8px;
    border-radius: 18px;
    background: var(--menu-grad);
    box-shadow: var(--shadow);
    position: relative;
  }
  .menubar-inner{
    display:flex; align-items:center; gap:14px;
    width:100%;
    padding: 10px 12px;
    border-radius: 14px;
    background: var(--menu-inner);
    color: #0b1020;
  }
  .left-pack{
    display:flex; align-items:center; gap:10px;
    padding:6px 10px;
    border-radius: 999px;
    background: var(--badge-bg);
    color:#1f2937;
    font-weight:700;
    white-space:nowrap;
  }
  .dot{ width:6px; height:6px; border-radius:50%; background:#0ea5ff; box-shadow:0 0 10px #0ea5ff; }

  .progress{
    width:150px; height:10px; border-radius:999px;
    background: rgba(255,255,255,.6); overflow:hidden;
  }
  .bar{ height:100%; width:0%; background: linear-gradient(90deg, #85d0ff, #d9e7ff); transition: width .2s ease; }

  .title{
    flex:1; text-align:center;
    letter-spacing: .4rem;  /* ì²¨ë¶€ ì´ë¯¸ì§€ì²˜ëŸ¼ ìê°„ ë„“ê²Œ */
    font-weight:800; color:#0b0d1a;
  }

  .menu-buttons{ display:flex; gap:10px; }
  .btn{
    border:0; cursor:pointer; border-radius:12px;
    color:#fff; padding:10px 14px; font-weight:800;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.25), 0 4px 10px rgba(0,0,0,.15);
  }
  .btn:active{ transform: translateY(1px); }
  .btn.gray{ background: var(--btn-gray); }
  .btn.blue{ background: var(--btn-blue); }

  /* ====== ìŠ¤í…Œì´ì§€ ====== */
  .stage{
    margin-top: 12px;
    background: var(--panel);
    border-radius: 16px;
    padding: 10px;
    box-shadow: var(--shadow);
    display:flex; justify-content:center;
  }
  canvas{
    display:block;
    background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.08));
    border-radius: 16px;
    touch-action: none; /* í„°ì¹˜ ìŠ¤í¬ë¡¤ ë°©ì§€ */
    /* width/heightëŠ” JSì—ì„œ ì •í™•í•œ pxë¡œ ì„¤ì •(ì •ì‚¬ê°í˜•) */
    max-width: 100%;
  }

  /* ìŠ¹ë¦¬ ì˜¤ë²„ë ˆì´ */
  .overlay{
    position: fixed; inset:0; display:none;
    align-items:center; justify-content:center;
    background: rgba(0,0,0,.45); z-index: 10;
  }
  .overlay .modal{
    width:min(92vw, 460px);
    background: linear-gradient(180deg, rgba(255,255,255,.2), rgba(255,255,255,.08));
    border-radius:18px; box-shadow: var(--shadow);
    padding:18px; color:#e9edf5;
  }
  .modal h2{ margin:0 0 8px 0; }
  .modal p{ margin:0 0 12px 0; color:#c9d2e3; }
  .modal .row{ display:flex; gap:8px; flex-wrap:wrap; }
</style>
</head>
<body>
<div class="app">
  <!-- ìƒë‹¨ ë©”ë‰´ë°” -->
  <div class="menubar">
    <div class="menubar-inner" id="menubarInner">
      <div class="left-pack" aria-live="polite">
        <span>ë ˆë²¨&nbsp;<span id="levelLabel">1</span></span>
        <span class="dot" aria-hidden="true"></span>
        <span>ê°„ì„ &nbsp;<span id="visCount">0</span>&nbsp;/&nbsp;<span id="edgeCount">0</span></span>
        <div class="progress"><div class="bar" id="bar"></div></div>
      </div>
      <div class="title">ë‚˜ë„&nbsp;&nbsp;ì˜¤ì¼ëŸ¬ì²˜ëŸ¼</div>
      <div class="menu-buttons">
        <button class="btn gray" id="sameBtn">ì´ˆê¸°í™”</button>
        <button class="btn blue" id="nextBtn">ë‹¤ìŒ ë‹¨ê³„</button>
      </div>
    </div>
  </div>

  <!-- ê²Œì„ ìŠ¤í…Œì´ì§€ -->
  <div class="stage">
    <canvas id="board" aria-label="ê·¸ë˜í”„ í¼ì¦ ìº”ë²„ìŠ¤"></canvas>
  </div>
</div>

<!-- ìŠ¹ë¦¬ ëª¨ë‹¬ -->
<div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="winTitle">
  <div class="modal">
    <h2 id="winTitle">ì„±ê³µ! ğŸ‰</h2>
    <p>ëª¨ë“  ê°„ì„ ì„ ì •í™•íˆ í•œ ë²ˆì”© ì§€ë‚¬ì–´ìš”.</p>
    <div class="row">
      <button class="btn gray" id="replayBtn">ê°™ì€ ë ˆë²¨ ë‹¤ì‹œ</button>
      <button class="btn blue" id="goNextBtn">ë‹¤ìŒ ë‹¨ê³„ â–¶</button>
    </div>
  </div>
</div>

<script>
(()=>{
  const canvas = document.getElementById('board');
  const ctx = canvas.getContext('2d');

  // ë©”ë‰´/í‘œì‹œ ìš”ì†Œ
  const levelLabel = document.getElementById('levelLabel');
  const visCountEl = document.getElementById('visCount');
  const edgeCountEl = document.getElementById('edgeCount');
  const barEl = document.getElementById('bar');

  const menubarInner = document.getElementById('menubarInner');

  // ë²„íŠ¼
  const sameBtn  = document.getElementById('sameBtn');   // ì´ˆê¸°í™”(ê°™ì€ í¼ì¦)
  const nextBtn  = document.getElementById('nextBtn');   // ë‹¤ìŒ ë‹¨ê³„
  const overlay  = document.getElementById('overlay');
  const replayBtn= document.getElementById('replayBtn');
  const goNextBtn= document.getElementById('goNextBtn');

  // ìƒíƒœ
  let level = 1;
  let nodes = [];      // [{x,y}]
  let edges = [];      // [{a,b, visited:false}]
  let used = new Set();// key "a-b" with a<b
  let current = null;  // í˜„ì¬ ì •ì  index
  let visitedCount = 0;
  let nodeR = 10;      // í¬ê¸° ë°˜ì‘í˜•
  let prevCssSize = null; // ì •ì‚¬ê° ìº”ë²„ìŠ¤ CSS px (ì¢Œí‘œ ìŠ¤ì¼€ì¼ ê¸°ì¤€)

  // ===== ìœ í‹¸ =====
  const key = (a,b)=> a<b ? `${a}-${b}` : `${b}-${a}`;
  const hasEdge = (a,b)=> used.has(key(a,b));
  const addEdge = (a,b)=>{ if(a===b || hasEdge(a,b)) return false; used.add(key(a,b)); edges.push({a,b,visited:false}); return true; };
  const neighbors = (i)=> edges.reduce((arr,e)=>{ if(e.a===i) arr.push([e.b, e]); else if(e.b===i) arr.push([e.a, e]); return arr;}, []);

  // ===== ë ˆì´ì•„ì›ƒ(íƒœë¸”ë¦¿ ìµœì  í¬ê¸° ê³„ì‚°) =====
  function layoutCanvasSquare(){
    // 1) ë©”ë‰´ë°” ì‹¤ì œ ë†’ì´ ì¸¡ì •
    const headerH = menubarInner.getBoundingClientRect().height + 16 /* menubar padding ì—¬ìœ  */;
    // 2) ë·°í¬íŠ¸ ê°€ìš© ë†’ì´ ê³„ì‚° (ì„¸ë¡œ/ê°€ë¡œ ëª¨ë‘ ëŒ€ì‘)
    const vh = window.innerHeight;
    const availH = Math.max(200, vh - headerH - 20); // í•˜ë‹¨ ì—¬ë°±
    // 3) ê°€ë¡œ í­ì€ ì»¨í…Œì´ë„ˆ í­
    const containerW = document.querySelector('.stage').getBoundingClientRect().width;
    // 4) ì •ì‚¬ê°í˜• í•œ ë³€(px)
    const size = Math.floor(Math.min(containerW, availH));
    // 5) CSS ì‹¤ì œ í”½ì…€ ì ìš©
    canvas.style.width = size + 'px';
    canvas.style.height = size + 'px';

    // ì¢Œí‘œ ìŠ¤ì¼€ì¼ ê°±ì‹ ì„ ìœ„í•´ prevCssSizeì™€ ë¹„êµ
    if(prevCssSize === null) prevCssSize = size;
    else if(size !== prevCssSize){
      const s = size / prevCssSize;
      if(isFinite(s) && s > 0){
        for(const p of nodes){ p.x *= s; p.y *= s; }
        prevCssSize = size;
      }
    }else{
      prevCssSize = size;
    }

    fitCanvasForDPR();
    nodeR = Math.max(7, Math.min(16, Math.round(size / 36)));
  }

  function fitCanvasForDPR(){
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    const rect = canvas.getBoundingClientRect(); // CSS px
    canvas.width  = Math.floor(rect.width * dpr);
    canvas.height = Math.floor(rect.height * dpr);
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }

  // ===== ê·¸ë˜í”„/í¼ì¦ ìƒì„± =====
  function placeNodes(n){
    const rect = canvas.getBoundingClientRect();
    const cx = rect.width/2, cy = rect.height/2;
    const r = Math.min(rect.width, rect.height) * 0.40;
    nodes = [];
    for(let i=0;i<n;i++){
      const t = (Math.PI*2) * (i/n) - Math.PI/2; // ìœ„ìª½ë¶€í„° ì‹œê³„ë°©í–¥
      nodes.push({ x: cx + r*Math.cos(t), y: cy + r*Math.sin(t) });
    }
    prevCssSize = rect.width; // í˜„ì¬ ì •ì‚¬ê° í•œ ë³€
  }

  function makeEulerGraph(n){
    edges = []; used.clear(); current = null; visitedCount = 0;

    // 1) ê¸°ë³¸ ì‚¬ì´í´
    for(let i=0;i<n;i++) addEdge(i, (i+1)%n);

    // 2) ë‚œì´ë„: chord ëª‡ ê°œ ì¶”ê°€(ì§ìˆ˜ ê°œ)
    const chordPairs = Math.min( Math.floor(n/3), 3 + Math.floor(level/2) );
    let tries = 0, added=0;
    while(added < chordPairs*2 && tries < 400){
      tries++;
      const a = Math.floor(Math.random()*n);
      let b = Math.floor(Math.random()*n);
      if(a===b) continue;
      if(hasEdge(a,b)) continue;
      if((a+1)%n===b || (b+1)%n===a) continue; // ì¸ì ‘ì€ íŒ¨ìŠ¤
      if(addEdge(a,b)) added++;
    }

    // 3) 50% í™•ë¥ ë¡œ í™€ìˆ˜ ì •ì  2ê°œ(ê²½ë¡œ) ë§Œë“¤ê¸°
    if(Math.random() < 0.5){
      let count=0;
      while(count<200){
        count++;
        const a = Math.floor(Math.random()*n);
        let b = Math.floor(Math.random()*n);
        if(a===b) continue;
        if(hasEdge(a,b)) continue;
        if(addEdge(a,b)) break;
      }
    }

    // UI ë°˜ì˜
    edgeCountEl.textContent = String(edges.length);
    setProgress(0);
  }

  // ===== ì§„í–‰/ê·¸ë¦¬ê¸° =====
  function setProgress(k){
    visitedCount = k;
    visCountEl.textContent = String(visitedCount);
    const p = edges.length ? Math.round((visitedCount/edges.length)*100) : 0;
    barEl.style.width = p + "%";
  }

  function draw(){
    const rect = canvas.getBoundingClientRect();
    ctx.clearRect(0,0,rect.width,rect.height);

    // ì€ì€í•œ ê²©ì
    ctx.save();
    ctx.globalAlpha = 0.08;
    ctx.beginPath();
    const step = Math.max(24, Math.round(rect.width/14));
    for(let x=step; x<rect.width; x+=step){ ctx.moveTo(x,0); ctx.lineTo(x,rect.height); }
    for(let y=step; y<rect.height; y+=step){ ctx.moveTo(0,y); ctx.lineTo(rect.width,y); }
    ctx.strokeStyle = '#ffffff';
    ctx.lineWidth = 1;
    ctx.stroke();
    ctx.restore();

    // ê°„ì„ 
    ctx.lineCap='round';
    for(const e of edges){
      const a=nodes[e.a], b=nodes[e.b];
      ctx.beginPath();
      ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y);
      ctx.lineWidth = e.visited ? Math.max(3, nodeR*0.95) : Math.max(2, nodeR*0.7);
      ctx.strokeStyle = e.visited ? '#3aa3ff' : 'rgba(255,255,255,0.45)';
      ctx.stroke();
    }

    // í—ˆìš© ì´ì›ƒ í•˜ì´ë¼ì´íŠ¸
    let allow = new Set();
    if(current!=null){
      for(const [nb, e] of neighbors(current)){ if(!e.visited) allow.add(nb); }
    }

    // ë…¸ë“œ
    for(let i=0;i<nodes.length;i++){
      const p = nodes[i];
      const isCur = (i===current);
      const isAllow = allow.has(i);
      ctx.beginPath();
      ctx.arc(p.x,p.y, nodeR+6, 0, Math.PI*2);
      ctx.fillStyle = isCur ? 'rgba(90,162,255,0.25)' : (isAllow ? 'rgba(77,226,176,0.22)' : 'transparent');
      ctx.fill();

      ctx.beginPath();
      ctx.arc(p.x,p.y, nodeR, 0, Math.PI*2);
      ctx.fillStyle = isCur ? '#66e27a' : (isAllow ? '#4de2b0' : '#ffffff');
      ctx.fill();
      ctx.lineWidth = 1.2; ctx.strokeStyle='rgba(0,0,0,0.35)'; ctx.stroke();

      ctx.font = `bold ${Math.max(10, nodeR*0.9)}px system-ui, sans-serif`;
      ctx.fillStyle = isCur ? '#0a2b21' : '#0b0d1a';
      ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.fillText(String(i+1), p.x, p.y+0.5);
    }
  }

  // ===== ì…ë ¥ ì²˜ë¦¬ =====
  function getPointerPos(evt){
    const rect = canvas.getBoundingClientRect();
    let x,y;
    if(evt.touches && evt.touches.length){
      x = evt.touches[0].clientX - rect.left;
      y = evt.touches[0].clientY - rect.top;
    }else{
      x = evt.clientX - rect.left;
      y = evt.clientY - rect.top;
    }
    return {x,y};
  }
  function findNodeAt(x,y){
    const r = nodeR * 1.5;
    for(let i=0;i<nodes.length;i++){
      const p = nodes[i];
      const dx=x-p.x, dy=y-p.y;
      if(dx*dx + dy*dy <= r*r) return i;
    }
    return -1;
  }
  function onPointer(evt){
    evt.preventDefault();
    const {x,y} = getPointerPos(evt);
    const i = findNodeAt(x,y);
    if(i>=0) tryMove(i);
  }
  canvas.addEventListener('pointerdown', onPointer, {passive:false});
  canvas.addEventListener('click', onPointer, {passive:false});

  function shake(el){
    el.style.transition='transform .08s ease';
    el.style.transform='translateX(-5px)';
    setTimeout(()=>{ el.style.transform='translateX(5px)'; }, 90);
    setTimeout(()=>{ el.style.transform='translateX(0)'; el.style.transition=''; }, 180);
  }

  function tryMove(to){
    if(current===null){
      current = to; draw(); return;
    }
    if(current===to) return;

    let found = null;
    for(const e of edges){
      if(e.visited) continue;
      if( (e.a===current && e.b===to) || (e.b===current && e.a===to) ){ found = e; break; }
    }
    if(!found){ shake(canvas.parentElement); return; }

    found.visited = true;
    setProgress(visitedCount+1);
    current = to; draw();

    if(visitedCount === edges.length){
      setTimeout(()=> overlay.style.display='flex', 120);
    }
  }

  // ===== ì»¨íŠ¸ë¡¤ =====
  sameBtn.addEventListener('click', ()=>{
    for(const e of edges) e.visited=false; // ê°™ì€ í¼ì¦ ì´ˆê¸°í™”
    setProgress(0); current=null; draw();
  });
  nextBtn.addEventListener('click', ()=>{
    level++; build(level);
  });
  replayBtn.addEventListener('click', ()=>{
    overlay.style.display='none'; build(level);
  });
  goNextBtn.addEventListener('click', ()=>{
    overlay.style.display='none'; level++; build(level);
  });

  // ===== ë¹Œë“œ & ë¦¬ì‚¬ì´ì¦ˆ =====
  function build(lv){
    levelLabel.textContent = String(lv);
    layoutCanvasSquare();      // ë¨¼ì € ì •ì‚¬ê° í¬ê¸° í™•ì •
    const n = Math.max(6, Math.min(14, 6 + Math.floor((lv-1)%9))); // 6~14
    placeNodes(n);
    makeEulerGraph(n);
    current=null; draw();
  }

  function onResize(){
    // ì •ì‚¬ê° CSS í¬ê¸° ì¬ê³„ì‚° + ì¢Œí‘œ ë¹„ë¡€ ìŠ¤ì¼€ì¼ + DPR ì¬ì„¤ì • + ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    layoutCanvasSquare();
    draw();
  }

  window.addEventListener('resize', onResize);
  window.addEventListener('orientationchange', onResize);

  // ì‹œì‘
  build(level);

})();
</script>
</body>
</html>
